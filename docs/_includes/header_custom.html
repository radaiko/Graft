<button id="wide-toggle" class="btn graft-toggle-btn" aria-label="Toggle wide layout" title="Toggle wide layout">&#x21D4;</button>
<button id="theme-toggle" class="btn graft-toggle-btn" aria-label="Toggle dark mode" title="Toggle dark mode">&#x1F319;</button>

<script>
(function() {
  var themeBtn = document.getElementById('theme-toggle');
  var wideBtn = document.getElementById('wide-toggle');

  /* swap stylesheet between light/dark */
  function setThemeDirect(theme) {
    if (typeof jtd !== 'undefined' && jtd.setTheme) {
      jtd.setTheme(theme);
      return;
    }
    /* fallback: swap stylesheet href */
    var links = document.querySelectorAll('link[rel="stylesheet"]');
    for (var i = 0; i < links.length; i++) {
      var href = links[i].getAttribute('href');
      if (href && href.indexOf('just-the-docs') !== -1) {
        links[i].setAttribute('href', href.replace(/just-the-docs-[a-z]+/, 'just-the-docs-' + theme));
      }
    }
  }

  function getThemeDirect() {
    if (typeof jtd !== 'undefined' && jtd.getTheme) {
      try {
        var t = jtd.getTheme();
        if (t === 'dark' || t === 'light') return t;
      } catch(e) {}
    }
    return localStorage.getItem('theme') ||
      (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
  }

  function updateThemeButton(theme) {
    themeBtn.textContent = theme === 'dark' ? 'â˜€' : 'ðŸŒ™';
    themeBtn.setAttribute('title', theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode');
  }

  var savedTheme = localStorage.getItem('theme') ||
    (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
  updateThemeButton(savedTheme);

  themeBtn.addEventListener('click', function() {
    var current = getThemeDirect();
    var next = current === 'dark' ? 'light' : 'dark';
    setThemeDirect(next);
    localStorage.setItem('theme', next);
    updateThemeButton(next);
  });

  function updateWideButton() {
    var wide = document.documentElement.classList.contains('wide-mode');
    wideBtn.textContent = wide ? 'â¬Œ' : 'â‡”';
    wideBtn.setAttribute('title', wide ? 'Switch to narrow layout' : 'Switch to wide layout');
  }

  updateWideButton();

  wideBtn.addEventListener('click', function() {
    document.documentElement.classList.toggle('wide-mode');
    var wide = document.documentElement.classList.contains('wide-mode');
    localStorage.setItem('wide-mode', wide ? 'true' : 'false');
    updateWideButton();
  });

  /* apply theme once jtd is ready (if it loads later) */
  window.addEventListener('DOMContentLoaded', function() {
    try { setThemeDirect(savedTheme); } catch(e) {}
  });
})();
</script>
